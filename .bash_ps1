#! /usr/bin/env bash
get_number(){
  echo -n $((RANDOM % 231))
}

random_256color(){
  local c=$(get_number)
  # bad constrast colors, get another one
  if [ "$c" -le 17 -o "$c" -ge 232 ]; then
    random_256color
  else
    echo -n "\e[38;05;${c}m"
  fi
}

#get a random color, for use outside ps1
r256=$(random_256color)

main () {
  # colors
  local purple="\[\e[34m\]"
  local pink="\[\e[35m\]"
  local green="\[\e[32m\]"
  local yellow="\[\e[33m\]"
  local light_black="\[\e[90m\]"
  local black="\[\e[30m\]"
  local _256_1="\[$r256\]"
  local _256_2="\[$(random_256color)\]"
  # other formatting
  local end="\[\e[0m\]"
  local underline="\[\e[4m\]"
  local bold="\[\e[1m\]"
  local decorations colorMain colorMeh colorText
  if [[ "$(uname -s)" =~ Darwin ]]; then
    #The spaces below avoids emoji collapsing on themselves. MacOS Sierra glitch.
    local spacer='  '
  else
    local spacer=''
  fi

  if [ "$(whoami)" != "root" ]; then
    case $(($RANDOM % 7)) in
      0)  decorations="ğŸº ğŸŒ‹"$spacer  ;;
      1)  decorations="ğŸŒ¸ ğŸŒ¿"$spacer  ;;
      2)  decorations="ğŸš€ ğŸ’«"$spacer  ;;
      3)  decorations="ğŸ ğŸ·"$spacer  ;;
      4)  decorations="ğŸ”® ğŸ¦‹"$spacer  ;;
      5)  decorations="ğŸŒ„ ğŸ†"$spacer  ;;
      6)  decorations="ğŸ‡ ğŸ¥“"$spacer  ;;
    esac
    colorMain=$_256_1
    colorMeh=$_256_2
  else
    colorMain=$purple
    colorMeh=$black
    colorText=$pink
    decorations="ğŸ’  ğŸ’ "$spacer
  fi

  local horizontalSeparator="$colorMeh$underline$(printf %${COLUMNS}s)$end\n"
  local workdir="$colorMain\w $end"
  local histoty="$colorMeh!\! $end"
  local clock="$colorMeh\@ $end"
  local S="$colorMain\\$ $end$colorText"

  printf "${horizontalSeparator}${clock}${workdir}\n${decorations}"
  # printf "${horizontalSeparator}${histoty}${workdir}${clock}\n${decorations}"
}
export PS1=$(main)
